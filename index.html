<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistem Data Barang - SD</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e3a8a, #3b82f6);
      min-height: 100vh;
    }

    .center { display: flex; justify-content: center; align-items: center; height: 100vh; }

    .login-box {
      background: white; padding: 35px; border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2); width: 340px; text-align: center;
    }

    input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ddd; }

    .btn { padding: 12px; border: none; border-radius: 10px; cursor: pointer; width: 100%; font-weight: bold; }
    .btn-login { background: #3b82f6; color: white; }

    .layout { display: none; min-height: 100vh; }

    .sidebar { width: 230px; background: #1e3a8a; color: white; padding: 25px 15px; }
    .nav-link { padding: 10px; margin-bottom: 10px; cursor: pointer; border-radius: 10px; }
    .nav-link:hover { background: rgba(255,255,255,0.15); }

    .main { flex: 1; padding: 25px; background: #f1f5f9; }

    .card { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-bottom: 20px; }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 10px; border-bottom: 1px solid #eee; }

    .img-preview { width: 45px; height: 45px; object-fit: cover; border-radius: 8px; }

    button { padding: 6px 10px; border: none; border-radius: 8px; cursor: pointer; font-size: 13px; margin-right: 5px; }
    .edit { background: #3b82f6; color: white; }
    .hapus { background: #ef4444; color: white; }
    .pinjam { background: #10b981; color: white; }

    #formBox { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); align-items: center; justify-content: center; }
    #formBox .box { background: white; padding: 25px; border-radius: 16px; width: 320px; }
  </style>
</head>

<body>

<div id="loginPage" class="center">
  <div class="login-box">
    <h2>üîê Login Admin</h2>
    <input type="text" id="username" placeholder="Username" />
    <input type="password" id="password" placeholder="Password" />
    <button class="btn btn-login" onclick="login()">Masuk</button>
    <p id="loginError" style="color:red; display:none;">Login salah</p>
  </div>
</div>

<div id="app" class="layout">
  <div class="sidebar">
    <h3>üè´ Menu</h3>
    <div class="nav-link" onclick="showPage('dashboard')">Dashboard</div>
    <div class="nav-link" onclick="showPage('barang')">Data Barang</div>
    <div class="nav-link" onclick="logout()">Logout</div>
  </div>

  <div class="main">

    <div id="dashboard" class="page card">
      <h2>Dashboard</h2>
      <p>Total Barang: <b id="totalBarang">0</b></p>
    </div>

    <div id="barang" class="page card" style="display:none;">
      <h2>Data Barang</h2>
      <button class="edit" onclick="openForm()">+ Tambah Barang</button>

      <table>
        <thead>
          <tr><th>Nama</th><th>Kode</th><th>Jumlah</th><th>Status</th><th>Gambar</th><th>Aksi</th></tr>
        </thead>
        <tbody id="tabel"></tbody>
      </table>
    </div>

  </div>
</div>

<div id="formBox">
  <div class="box">
    <input type="hidden" id="editId">
    <input id="nama" placeholder="Nama Barang">
    <input id="jumlah" type="number" placeholder="Jumlah">
    <input id="gambar" type="file" accept="image/*">

    <button class="edit" onclick="simpan()">Simpan</button>
    <button class="hapus" onclick="tutupForm()">Batal</button>
  </div>
</div>

<script>
const ADMIN_USER = "admin";
const ADMIN_PASS = "lazuardi";

function login() {
  if (username.value === ADMIN_USER && password.value === ADMIN_PASS) {
    localStorage.setItem("login_sd", "true");
    cekLogin();
  } else loginError.style.display = "block";
}

function logout() { localStorage.removeItem("login_sd"); location.reload(); }

function cekLogin() {
  if (localStorage.getItem("login_sd") === "true") {
    loginPage.style.display = "none";
    app.style.display = "flex";
    render();
  }
}

let barang = JSON.parse(localStorage.getItem("barang_sd")) || [];

function simpanStorage() { localStorage.setItem("barang_sd", JSON.stringify(barang)); }

function kodeOtomatis() { return "SD-" + Date.now().toString().slice(-5); }

function showPage(id) {
  document.querySelectorAll(".page").forEach(p => p.style.display = "none");
  document.getElementById(id).style.display = "block";
}

function openForm(id=null) {
  formBox.style.display = "flex";

  if (id) {
    const b = barang.find(x=>x.id===id);
    editId.value = b.id;
    nama.value = b.nama;
    jumlah.value = b.jumlah;
  } else {
    editId.value = "";
    nama.value = jumlah.value = "";
  }
}

function tutupForm() { formBox.style.display = "none"; }

function simpan() {
  if (!nama.value || !jumlah.value) return alert("Lengkapi data");

  const file = gambar.files[0];

  function lanjut(img) {
    if (editId.value) {
      const i = barang.findIndex(x=>x.id==editId.value);
      barang[i] = { ...barang[i], nama:nama.value, jumlah:+jumlah.value, gambar: img || barang[i].gambar };
    } else {
      barang.push({ id:Date.now(), kode:kodeOtomatis(), nama:nama.value, jumlah:+jumlah.value, status:"Tersedia", gambar: img||"" });
    }

    simpanStorage(); tutupForm(); render();
  }

  if (file) { const r = new FileReader(); r.onload = e=>lanjut(e.target.result); r.readAsDataURL(file); }
  else lanjut(null);
}

function pinjam(id) {
  const b = barang.find(x=>x.id===id);
  if (b.jumlah <= 0) return alert("Stok habis");
  b.jumlah--;
  b.status = b.jumlah === 0 ? "Dipinjam" : "Tersedia";
  simpanStorage(); render();
}

function hapus(id) {
  if (!confirm("Hapus barang?") ) return;
  barang = barang.filter(x=>x.id!==id);
  simpanStorage(); render();
}

function render() {
  tabel.innerHTML = "";

  barang.forEach(b=>{
    tabel.innerHTML += `
      <tr>
        <td>${b.nama}</td>
        <td>${b.kode}</td>
        <td>${b.jumlah}</td>
        <td>${b.status}</td>
        <td>${b.gambar?`<img src="${b.gambar}" class="img-preview">`:"-"}</td>
        <td>
          <button class="pinjam" onclick="pinjam(${b.id})">Pinjam</button>
          <button class="edit" onclick="openForm(${b.id})">Edit</button>
          <button class="hapus" onclick="hapus(${b.id})">Hapus</button>
        </td>
      </tr>`;
  });

  totalBarang.textContent = barang.length;
}

cekLogin();
</script>

</body>
</html>

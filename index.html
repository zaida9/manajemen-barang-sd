<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes" />
  <title>Sistem Inventaris SD Â· Lazuardi</title>

  <!-- FIREBASE SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <!-- CHART.JS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- FONTS & ICONS -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #0284c7;
      --primary-dark: #0369a1;
      --primary-light: #e0f2fe;
      --secondary: #f59e0b;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --dark: #0f172a;
      --gray: #64748b;
      --light: #f8fafc;
      --border: #e2e8f0;
      --purple: #8b5cf6;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #f1f5f9;
      color: var(--dark);
      line-height: 1.5;
    }

    /* ========== TOAST ========== */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .toast {
      background: white;
      border-radius: 1rem;
      padding: 1rem 1.5rem;
      box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      min-width: 300px;
      animation: slideIn 0.3s ease;
      border-left: 5px solid;
    }

    .toast.success { border-left-color: var(--success); }
    .toast.error { border-left-color: var(--danger); }
    .toast.warning { border-left-color: var(--warning); }
    .toast.info { border-left-color: var(--primary); }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* ========== LOADING ========== */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(5px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9998;
      flex-direction: column;
      gap: 1rem;
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 5px solid var(--primary-light);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* ========== MODAL EDIT ========== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(5px);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      border-radius: 2rem;
      padding: 2rem;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 3px solid var(--primary-light);
    }

    .modal-header h3 {
      font-size: 1.5rem;
      font-weight: 700;
      color: #075985;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gray);
      padding: 0.5rem;
    }

    .modal-close:hover {
      color: var(--danger);
    }

    /* ========== LOGIN ========== */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(145deg, #e0f2fe 0%, #bae6fd 100%);
      padding: 1.5rem;
    }

    .glass-card {
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.5);
      border-radius: 2rem;
      padding: 2.5rem 2rem;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15);
    }

    .glass-card h2 {
      font-weight: 800;
      font-size: 1.8rem;
      color: #075985;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .input-group {
      margin-bottom: 1.25rem;
    }

    .input-group label {
      display: block;
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #334155;
      margin-bottom: 0.4rem;
    }

    .input-field {
      width: 100%;
      padding: 0.9rem 1.2rem;
      background: white;
      border: 2px solid var(--border);
      border-radius: 1.2rem;
      font-size: 1rem;
      transition: 0.2s ease;
      outline: none;
    }

    .input-field:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(2,132,199,0.15);
    }

    .btn-login {
      width: 100%;
      padding: 0.9rem;
      background: linear-gradient(115deg, #0369a1, #0284c7);
      border: none;
      border-radius: 1.5rem;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
      cursor: pointer;
      transition: 0.2s;
    }

    .btn-login:hover {
      transform: scale(1.02);
      background: linear-gradient(115deg, #075985, #0369a1);
    }

    #loginError {
      color: #b91c1c;
      font-weight: 600;
      margin-top: 1rem;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    /* ========== LAYOUT ========== */
    .layout {
      display: none;
      min-height: 100vh;
    }

    .sidebar {
      position: fixed;
      width: 280px;
      height: 100vh;
      background: linear-gradient(170deg, #0c4a6e, #075985);
      padding: 2rem 1.5rem;
      color: white;
      display: flex;
      flex-direction: column;
      box-shadow: 4px 0 20px rgba(0,0,0,0.08);
    }

    .sidebar h2 {
      font-size: 1.6rem;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid rgba(255,255,255,0.15);
    }

    /* ========== PROFIL USER ========== */
    .user-profile {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border-radius: 1.5rem;
      padding: 1.5rem 1.2rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .user-avatar {
      width: 60px;
      height: 60px;
      background: linear-gradient(145deg, #f59e0b, #d97706);
      border-radius: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      color: white;
      box-shadow: 0 10px 20px -5px rgba(0,0,0,0.3);
    }

    .user-info {
      flex: 1;
    }

    .user-name {
      font-weight: 700;
      font-size: 1.1rem;
      margin-bottom: 0.2rem;
    }

    .user-role {
      display: inline-block;
      padding: 0.2rem 1rem;
      background: rgba(2,132,199,0.3);
      border-radius: 2rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border: 1px solid rgba(255,255,255,0.3);
    }

    .menu {
      flex: 1;
    }

    .menu a {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      color: rgba(255,255,255,0.85);
      padding: 0.9rem 1.2rem;
      border-radius: 1.2rem;
      margin-bottom: 0.4rem;
      cursor: pointer;
      transition: 0.2s;
    }

    .menu a i {
      width: 1.5rem;
      text-align: center;
    }

    .menu a:hover, .menu a.active {
      background: rgba(255,255,255,0.15);
      color: white;
    }

    .logout-btn {
      margin-top: 1rem;
      background: rgba(239,68,68,0.15);
      border: 1px solid rgba(239,68,68,0.3);
    }

    .logout-btn:hover {
      background: rgba(239,68,68,0.3) !important;
    }

    .content {
      margin-left: 280px;
      padding: 2rem 2.5rem;
      width: calc(100% - 280px);
    }

    /* ========== CARD ========== */
    .card {
      background: white;
      border-radius: 1.75rem;
      padding: 1.8rem 2rem;
      box-shadow: 0 10px 30px -5px rgba(0,0,0,0.03);
      margin-bottom: 2rem;
      border: 1px solid rgba(255,255,255,0.8);
    }

    .card h3 {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-size: 1.3rem;
      font-weight: 700;
      color: #075985;
      margin-bottom: 1.5rem;
      padding-bottom: 0.8rem;
      border-bottom: 3px solid var(--primary-light);
    }

    /* ========== FORM ========== */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    input, select, textarea {
      background: #f8fafc;
      border: 2px solid var(--border);
      border-radius: 1rem;
      padding: 0.9rem 1.2rem;
      width: 100%;
      font-size: 0.98rem;
      outline: none;
    }

    input:focus, select:focus {
      border-color: var(--primary);
      background: white;
      box-shadow: 0 0 0 4px #bae6fd;
    }

    /* ========== BUTTONS ========== */
    .btn-primary, .btn-warning, .btn-danger, .btn-success, .btn-edit {
      border: none;
      padding: 0.8rem 1.8rem;
      border-radius: 2rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      cursor: pointer;
      color: white;
      transition: 0.2s;
    }

    .btn-primary { background: var(--primary); }
    .btn-success { background: var(--success); }
    .btn-warning { background: var(--warning); }
    .btn-danger { background: var(--danger); }
    .btn-edit { background: var(--purple); }

    .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); }
    .btn-success:hover { background: #0b9e6e; transform: translateY(-2px); }
    .btn-warning:hover { background: #d97706; transform: translateY(-2px); }
    .btn-danger:hover { background: #b91c1c; transform: translateY(-2px); }
    .btn-edit:hover { background: #7c3aed; transform: translateY(-2px); }

    /* ========== BADGE STATUS ========== */
    .badge {
      padding: 0.3rem 1rem;
      border-radius: 2rem;
      font-size: 0.8rem;
      font-weight: 600;
      display: inline-block;
    }
    
    .badge-success {
      background: #d1fae5;
      color: #065f46;
    }
    
    .badge-warning {
      background: #fef3c7;
      color: #92400e;
    }
    
    .badge-danger {
      background: #fee2e2;
      color: #b91c1c;
    }

    /* ========== TABLE ========== */
    .table-responsive {
      overflow-x: auto;
      border-radius: 1rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background: #f0f9ff;
      color: #075985;
      font-weight: 700;
      font-size: 0.85rem;
      text-transform: uppercase;
      padding: 1rem;
    }

    td {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      vertical-align: middle;
    }

    tr:hover td {
      background: #fafdff;
    }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    /* ========== STATS ========== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: 1.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      box-shadow: 0 10px 25px -10px rgba(0,0,0,0.02);
    }

    .stat-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(145deg, var(--primary-light), #bae6fd);
      border-radius: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      color: var(--primary-dark);
    }

    .stat-content h4 { 
      font-size: 0.9rem; 
      color: var(--gray); 
      margin-bottom: 0.2rem;
    }
    
    .stat-content span { 
      font-size: 2.2rem; 
      font-weight: 800; 
      color: var(--dark); 
    }

    /* ========== CHARTS ========== */
    .charts-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    .chart-container {
      background: white;
      border-radius: 1.75rem;
      padding: 1.5rem;
      box-shadow: 0 10px 30px -5px rgba(0,0,0,0.03);
    }

    .chart-container h4 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #075985;
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    canvas {
      width: 100% !important;
      height: 250px !important;
    }

    /* ========== IMAGE ========== */
    .img-preview {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 1rem;
      border: 3px solid white;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s;
    }

    .img-preview:hover {
      transform: scale(1.1);
    }

    .file-label {
      background: #f1f5f9;
      padding: 0.8rem 1.5rem;
      border-radius: 2rem;
      display: inline-block;
      cursor: pointer;
      border: 2px dashed #94a3b8;
      transition: all 0.3s;
    }

    .file-label:hover {
      background: #e2e8f0;
      border-color: var(--primary);
    }

    .hidden { display: none !important; }

    @media (max-width: 1024px) {
      .charts-grid { grid-template-columns: 1fr; }
    }

    @media (max-width: 768px) {
      .sidebar { width: 100px; padding: 1rem; }
      .sidebar h2 span, .menu a span, .user-profile .user-info { display: none; }
      .user-profile { justify-content: center; }
      .content { margin-left: 100px; width: calc(100% - 100px); padding: 1rem; }
      .form-grid { grid-template-columns: 1fr; }
      .action-buttons { flex-direction: column; }
    }
  </style>
</head>
<body>

<!-- ========== TOAST ========== -->
<div id="toastContainer" class="toast-container"></div>

<!-- ========== LOADING ========== -->
<div id="loadingOverlay" class="loading-overlay">
  <div class="spinner"></div>
  <p style="color: var(--primary); font-weight: 600;">Sedang memproses...</p>
</div>

<!-- ========== MODAL EDIT BARANG ========== -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3><i class="fas fa-edit"></i> Edit Barang</h3>
      <button class="modal-close" onclick="closeEditModal()">&times;</button>
    </div>
    <div id="editForm">
      <input type="hidden" id="editId">
      <input type="hidden" id="editOldImageUrl">
      <input type="hidden" id="editDeleteUrl">
      
      <div class="form-group" style="margin-bottom: 1rem;">
        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Kode Barang</label>
        <input type="text" id="editKode" readonly style="background: #f1f5f9;">
      </div>

      <div class="form-group" style="margin-bottom: 1rem;">
        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Nama Barang</label>
        <input type="text" id="editNama" placeholder="Nama Barang">
      </div>

      <div class="form-grid" style="margin-bottom: 1rem;">
        <div>
          <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Kategori</label>
          <select id="editKategori">
            <option value="Elektronik">Elektronik</option>
            <option value="Perabot">Perabot</option>
            <option value="ATK">ATK</option>
            <option value="Lainnya">Lainnya</option>
          </select>
        </div>
        <div>
          <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Stok</label>
          <input type="number" id="editJumlah" placeholder="Jumlah Stok">
        </div>
      </div>

      <div style="margin: 1.5rem 0;">
        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">Gambar Saat Ini</label>
        <img id="editCurrentImage" src="" alt="Current" style="width: 100px; height: 100px; object-fit: cover; border-radius: 1rem; border: 3px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 1rem;">
        
        <label for="editGambar" class="file-label" style="margin-top: 0.5rem;">
          <i class="fas fa-cloud-upload-alt"></i> 
          <span id="editFileName">Ganti Gambar (opsional)</span>
        </label>
        <input type="file" id="editGambar" accept="image/*" style="display: none;" onchange="previewEditImage(this)">
        <div id="editImagePreview" style="margin-top: 1rem; display: none;">
          <img src="" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 1rem;">
        </div>
      </div>

      <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
        <button class="btn-danger" onclick="closeEditModal()" style="background: var(--gray);">
          <i class="fas fa-times"></i> Batal
        </button>
        <button class="btn-success" onclick="updateBarang()">
          <i class="fas fa-save"></i> Simpan Perubahan
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ========== LOGIN PAGE ========== -->
<div id="loginPage" class="login-container">
  <div class="glass-card">
    <h2><i class="fas fa-school"></i> SD Lazuardi</h2>
    <p style="color: #164863; margin-bottom: 1.8rem; font-weight: 500;">Sistem Inventaris Sekolah</p>
    
    <div class="input-group">
      <label><i class="fas fa-user"></i> Username</label>
      <input type="text" id="username" class="input-field" placeholder="Masukkan username" value="admin">
    </div>
    
    <div class="input-group">
      <label><i class="fas fa-lock"></i> Password</label>
      <input type="password" id="password" class="input-field" placeholder="Masukkan password" value="lazuardi">
    </div>
    
    <div class="input-group">
      <label><i class="fas fa-user-tag"></i> Role</label>
      <select id="role" class="input-field">
        <option value="admin">Admin</option>
        <option value="guru">Guru</option>
      </select>
    </div>

    <button class="btn-login" onclick="login()">
      <i class="fas fa-arrow-right-to-bracket"></i> Masuk
    </button>
    
    <div id="loginError">
      <i class="fas fa-circle-exclamation"></i> Username atau password salah!
    </div>
  </div>
</div>

<!-- ========== APP ========== -->
<div class="layout" id="app">
  <!-- SIDEBAR DENGAN PROFIL -->
  <div class="sidebar">
    <h2><i class="fas fa-cubes"></i> <span>SD Lazuardi</span></h2>
    
    <!-- ========== PROFIL USER ========== -->
    <div class="user-profile" id="userProfile">
      <div class="user-avatar">
        <i class="fas fa-user-graduate"></i>
      </div>
      <div class="user-info">
        <div class="user-name" id="displayName">Admin</div>
        <span class="user-role" id="displayRole">ADMIN</span>
      </div>
    </div>

    <div class="menu">
      <a onclick="showPage('dashboard')" class="active" id="menu-dashboard">
        <i class="fas fa-chart-pie"></i> <span>Dashboard</span>
      </a>
      <a onclick="showPage('barang')" id="menu-barang">
        <i class="fas fa-boxes"></i> <span>Data Barang</span>
      </a>
      <a onclick="showPage('pinjam')" id="menu-pinjam">
        <i class="fas fa-hand-holding"></i> <span>Peminjaman</span>
      </a>
      <a onclick="logout()" class="logout-btn">
        <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
      </a>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="content">
    <!-- ========== DASHBOARD DENGAN GRAFIK ========== -->
    <div id="dashboard">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-box"></i></div>
          <div class="stat-content">
            <h4>Total Barang</h4>
            <span id="totalBarang">0</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-hand-holding"></i></div>
          <div class="stat-content">
            <h4>Dipinjam</h4>
            <span id="totalPinjam">0</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
          <div class="stat-content">
            <h4>Tersedia</h4>
            <span id="totalTersedia">0</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
          <div class="stat-content">
            <h4>Stok Menipis</h4>
            <span id="totalMenipis">0</span>
          </div>
        </div>
      </div>

      <!-- GRAFIK DASHBOARD -->
      <div class="charts-grid">
        <div class="chart-container">
          <h4><i class="fas fa-chart-bar"></i> Stok Barang (Top 5)</h4>
          <canvas id="stockChart"></canvas>
        </div>
        <div class="chart-container">
          <h4><i class="fas fa-chart-line"></i> Tren Peminjaman (7 Hari Terakhir)</h4>
          <canvas id="pinjamChart"></canvas>
        </div>
      </div>

      <!-- PEMINJAMAN TERBARU -->
      <div class="card">
        <h3><i class="fas fa-clock"></i> Peminjaman Terbaru</h3>
        <div id="recentPinjam" style="max-height: 250px; overflow-y: auto;">
          <!-- Dynamic content -->
        </div>
      </div>
    </div>

    <!-- ========== DATA BARANG ========== -->
    <div id="barang" class="hidden">
      <!-- FORM TAMBAH BARANG -->
      <div class="card">
        <h3><i class="fas fa-plus-circle"></i> Tambah Barang</h3>
        <div class="form-grid">
          <input type="text" id="nama" placeholder="Nama Barang">
          <input type="number" id="jumlah" placeholder="Jumlah Stok">
          <select id="kategori">
            <option value="">Pilih Kategori</option>
            <option value="Elektronik">Elektronik</option>
            <option value="Perabot">Perabot</option>
            <option value="ATK">ATK</option>
            <option value="Lainnya">Lainnya</option>
          </select>
        </div>
        
        <!-- UPLOAD GAMBAR -->
        <div style="margin: 1.5rem 0;">
          <label for="gambar" class="file-label">
            <i class="fas fa-cloud-upload-alt"></i> 
            <span id="fileName">Pilih Gambar</span>
          </label>
          <input type="file" id="gambar" accept="image/*" style="display: none;" onchange="previewImage(this)">
          <div id="imagePreview" style="margin-top: 1rem; display: none;">
            <img src="" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 1rem;">
          </div>
        </div>

        <button class="btn-primary" onclick="tambahBarang()">
          <i class="fas fa-save"></i> Simpan Barang
        </button>
      </div>

      <!-- SEARCH -->
      <div class="card">
        <input type="text" id="searchBarang" placeholder="ðŸ” Cari nama atau kode barang..." onkeyup="filterBarang()">
      </div>

      <!-- TABEL BARANG DENGAN TOMBOL EDIT & HAPUS -->
      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h3><i class="fas fa-list"></i> Daftar Barang</h3>
          <button class="btn-success" onclick="exportExcel()">
            <i class="fas fa-file-excel"></i> Excel
          </button>
        </div>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Kode</th>
                <th>Gambar</th>
                <th>Nama</th>
                <th>Kategori</th>
                <th>Stok</th>
                <th>Status</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="tabelBarang"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ========== PEMINJAMAN ========== -->
    <div id="pinjam" class="hidden">
      <!-- FORM PINJAM -->
      <div class="card">
        <h3><i class="fas fa-hand-holding-heart"></i> Form Peminjaman</h3>
        <div class="form-grid">
          <input type="text" id="peminjam" placeholder="Nama Peminjam">
          <select id="barangSelect">
            <option value="">Pilih Barang</option>
          </select>
          <input type="number" id="jumlahPinjam" placeholder="Jumlah">
          <input type="date" id="tanggalPinjam">
        </div>
        <button class="btn-warning" onclick="pinjamBarang()" style="margin-top: 1rem;">
          <i class="fas fa-check-circle"></i> Pinjam Barang
        </button>
      </div>

      <!-- PEMINJAMAN AKTIF -->
      <div class="card">
        <h3><i class="fas fa-clock"></i> Peminjaman Aktif</h3>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Peminjam</th>
                <th>Barang</th>
                <th>Jumlah</th>
                <th>Tanggal</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="tabelPinjamAktif"></tbody>
          </table>
        </div>
      </div>

      <!-- RIWAYAT PEMINJAMAN -->
      <div class="card">
        <h3><i class="fas fa-history"></i> Riwayat Peminjaman</h3>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Peminjam</th>
                <th>Barang</th>
                <th>Jumlah</th>
                <th>Tanggal</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="tabelRiwayat"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // ========== FIREBASE ==========
  const firebaseConfig = {
    apiKey: "AIzaSyAVeXYR1sI6YC9xOVhlBSbf0RFMr9Ams1g",
    authDomain: "inventaris-sd.firebaseapp.com",
    projectId: "inventaris-sd",
    storageBucket: "inventaris-sd.firebasestorage.app",
    messagingSenderId: "421661627652",
    appId: "1:421661627652:web:9ae755b3a997b8544e6c51"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ========== GLOBAL ==========
  let currentRole = 'admin';
  let currentUser = 'Admin';
  let barangData = [];
  let pinjamData = [];
  let stockChart = null;
  let pinjamChart = null;

  // ========== API KEY IMGBB ==========
  const IMGBB_API_KEY = '0037c299ecb5215d3e142b7993842a11';

  // ========== TOAST ==========
  function showToast(message, type = 'success') {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    let icon = 'fa-check-circle';
    if (type === 'error') icon = 'fa-exclamation-circle';
    if (type === 'warning') icon = 'fa-exclamation-triangle';
    if (type === 'info') icon = 'fa-info-circle';
    
    toast.innerHTML = `
      <i class="fas ${icon}"></i>
      <span style="flex:1; font-weight:500;">${message}</span>
      <button onclick="this.parentElement.remove()" style="background:none; border:none; cursor:pointer; color:var(--gray);">
        <i class="fas fa-times"></i>
      </button>
    `;
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 5000);
  }

  // ========== LOADING ==========
  function showLoading() { 
    document.getElementById('loadingOverlay').style.display = 'flex'; 
  }
  
  function hideLoading() { 
    document.getElementById('loadingOverlay').style.display = 'none'; 
  }

  // ========== LOGIN ==========
  function login() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const role = document.getElementById('role').value;
    const loginError = document.getElementById('loginError');

    if (username === 'admin' && password === 'lazuardi') {
      currentRole = role;
      currentUser = username;
      
      localStorage.setItem('login', 'true');
      localStorage.setItem('role', currentRole);
      localStorage.setItem('username', currentUser);
      
      showToast(`Selamat datang, ${username}!`, 'success');
      cekLogin();
    } else {
      loginError.style.display = 'flex';
    }
  }

  // ========== LOGOUT ==========
  function logout() {
    localStorage.removeItem('login');
    localStorage.removeItem('role');
    localStorage.removeItem('username');
    showToast('Berhasil logout!', 'info');
    location.reload();
  }

  // ========== CEK LOGIN ==========
  function cekLogin() {
    if (localStorage.getItem('login') === 'true') {
      currentRole = localStorage.getItem('role') || 'admin';
      currentUser = localStorage.getItem('username') || 'Admin';
      
      document.getElementById('displayName').innerText = currentUser;
      document.getElementById('displayRole').innerHTML = currentRole.toUpperCase();
      
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('app').style.display = 'flex';
      
      loadData();
      initCharts();
      
      const today = new Date().toISOString().split('T')[0];
      if (document.getElementById('tanggalPinjam')) {
        document.getElementById('tanggalPinjam').value = today;
      }
    }
  }

  // ========== SHOW PAGE ==========
  function showPage(pageId) {
    ['dashboard', 'barang', 'pinjam'].forEach(p => 
      document.getElementById(p).classList.add('hidden')
    );
    document.getElementById(pageId).classList.remove('hidden');
    
    document.querySelectorAll('.menu a').forEach(el => el.classList.remove('active'));
    document.getElementById(`menu-${pageId}`).classList.add('active');
    
    if (pageId === 'dashboard') {
      updateCharts();
    }
  }

  // ========== PREVIEW GAMBAR ==========
  function previewImage(input) {
    const fileName = document.getElementById('fileName');
    const preview = document.getElementById('imagePreview');
    const previewImg = preview.querySelector('img');
    
    if (input.files && input.files[0]) {
      fileName.innerHTML = input.files[0].name;
      const reader = new FileReader();
      reader.onload = function(e) {
        previewImg.src = e.target.result;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(input.files[0]);
    } else {
      fileName.innerHTML = 'Pilih Gambar';
      preview.style.display = 'none';
    }
  }

  // ========== PREVIEW EDIT GAMBAR ==========
  function previewEditImage(input) {
    const fileName = document.getElementById('editFileName');
    const preview = document.getElementById('editImagePreview');
    const previewImg = preview.querySelector('img');
    
    if (input.files && input.files[0]) {
      fileName.innerHTML = input.files[0].name;
      const reader = new FileReader();
      reader.onload = function(e) {
        previewImg.src = e.target.result;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(input.files[0]);
    } else {
      fileName.innerHTML = 'Ganti Gambar (opsional)';
      preview.style.display = 'none';
    }
  }

  // ========== UPLOAD KE IMGBB ==========
  async function uploadToImgBB(file) {
    const formData = new FormData();
    formData.append('image', file);
    
    try {
      const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
        method: 'POST',
        body: formData
      });
      
      const data = await response.json();
      
      if (data.success) {
        return {
          url: data.data.url,
          thumb: data.data.thumb.url,
          delete_url: data.data.delete_url
        };
      } else {
        throw new Error(data.error?.message || 'Upload gagal');
      }
    } catch (error) {
      console.error('Error upload:', error);
      throw error;
    }
  }

  // ========== TAMBAH BARANG ==========
  async function tambahBarang() {
    const nama = document.getElementById('nama').value;
    const jumlah = document.getElementById('jumlah').value;
    const kategori = document.getElementById('kategori').value;
    const file = document.getElementById('gambar').files[0];

    if (!nama || !jumlah || !kategori || !file) {
      showToast('Lengkapi semua data!', 'error');
      return;
    }

    showLoading();

    try {
      showToast('ðŸ“¤ Mengupload gambar...', 'info');
      const imageData = await uploadToImgBB(file);
      
      const snapshot = await db.collection('barang').get();
      const kode = 'SD-' + String(snapshot.size + 1).padStart(3, '0');
      
      await db.collection('barang').add({
        kode: kode,
        nama: nama,
        jumlah: parseInt(jumlah),
        kategori: kategori,
        gambar: imageData.url,
        thumbnail: imageData.thumb,
        imgbb_delete_url: imageData.delete_url,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      showToast('âœ… Barang berhasil ditambahkan!', 'success');
      
      document.getElementById('nama').value = '';
      document.getElementById('jumlah').value = '';
      document.getElementById('kategori').value = '';
      document.getElementById('gambar').value = '';
      document.getElementById('fileName').innerHTML = 'Pilih Gambar';
      document.getElementById('imagePreview').style.display = 'none';

    } catch (error) {
      showToast('âŒ Gagal: ' + error.message, 'error');
    }

    hideLoading();
  }

  // ========== EDIT BARANG ==========
  function editBarang(id, kode, nama, kategori, jumlah, gambar, thumb, deleteUrl) {
    document.getElementById('editId').value = id;
    document.getElementById('editKode').value = kode;
    document.getElementById('editNama').value = nama;
    document.getElementById('editKategori').value = kategori;
    document.getElementById('editJumlah').value = jumlah;
    document.getElementById('editCurrentImage').src = thumb || gambar || 'https://via.placeholder.com/100';
    document.getElementById('editOldImageUrl').value = gambar;
    document.getElementById('editDeleteUrl').value = deleteUrl || '';
    
    document.getElementById('editFileName').innerHTML = 'Ganti Gambar (opsional)';
    document.getElementById('editImagePreview').style.display = 'none';
    document.getElementById('editGambar').value = '';
    
    document.getElementById('editModal').style.display = 'flex';
  }

  // ========== CLOSE EDIT MODAL ==========
  function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
  }

  // ========== UPDATE BARANG ==========
  async function updateBarang() {
    const id = document.getElementById('editId').value;
    const nama = document.getElementById('editNama').value;
    const kategori = document.getElementById('editKategori').value;
    const jumlah = parseInt(document.getElementById('editJumlah').value);
    const file = document.getElementById('editGambar').files[0];
    const oldImageUrl = document.getElementById('editOldImageUrl').value;
    const oldDeleteUrl = document.getElementById('editDeleteUrl').value;

    if (!nama || !kategori || !jumlah) {
      showToast('Lengkapi semua data!', 'error');
      return;
    }

    showLoading();

    try {
      let updateData = {
        nama: nama,
        kategori: kategori,
        jumlah: jumlah
      };

      // Kalau ada gambar baru
      if (file) {
        showToast('ðŸ“¤ Mengupload gambar baru...', 'info');
        const imageData = await uploadToImgBB(file);
        
        updateData.gambar = imageData.url;
        updateData.thumbnail = imageData.thumb;
        updateData.imgbb_delete_url = imageData.delete_url;

        // Hapus gambar lama dari ImgBB
        if (oldDeleteUrl) {
          try {
            await fetch(oldDeleteUrl);
          } catch (e) {
            console.log('Gagal hapus gambar lama:', e);
          }
        }
      }

      await db.collection('barang').doc(id).update(updateData);
      
      showToast('âœ… Barang berhasil diupdate!', 'success');
      closeEditModal();

    } catch (error) {
      showToast('âŒ Gagal: ' + error.message, 'error');
    }

    hideLoading();
  }

  // ========== HAPUS BARANG ==========
  async function hapusBarang(id, imgbbDeleteUrl) {
    if (!confirm('Yakin ingin menghapus barang ini?')) return;
    
    showLoading();
    try {
      if (imgbbDeleteUrl) {
        try {
          await fetch(imgbbDeleteUrl);
        } catch (e) {
          console.log('Gagal hapus gambar:', e);
        }
      }
      
      await db.collection('barang').doc(id).delete();
      showToast('âœ… Barang berhasil dihapus!', 'success');
    } catch (error) {
      showToast('âŒ Gagal: ' + error.message, 'error');
    }
    hideLoading();
  }

  // ========== PINJAM BARANG ==========
  async function pinjamBarang() {
    const barangId = document.getElementById('barangSelect').value;
    const peminjam = document.getElementById('peminjam').value;
    const jumlah = parseInt(document.getElementById('jumlahPinjam').value);
    const tanggal = document.getElementById('tanggalPinjam').value;

    if (!barangId || !peminjam || !jumlah) {
      showToast('Lengkapi data peminjaman!', 'error');
      return;
    }

    showLoading();

    try {
      const barangRef = db.collection('barang').doc(barangId);
      const barangDoc = await barangRef.get();
      const barang = barangDoc.data();

      if (jumlah > barang.jumlah) {
        hideLoading();
        showToast('Stok tidak mencukupi!', 'error');
        return;
      }

      await barangRef.update({ jumlah: barang.jumlah - jumlah });

      await db.collection('pinjam').add({
        barangId,
        barangNama: barang.nama,
        peminjam,
        jumlah,
        tanggal,
        status: 'aktif',
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      showToast('âœ… Peminjaman berhasil!', 'success');
      
      document.getElementById('peminjam').value = '';
      document.getElementById('jumlahPinjam').value = '';

    } catch (error) {
      showToast('âŒ Gagal: ' + error.message, 'error');
    }

    hideLoading();
  }

  // ========== KEMBALIKAN BARANG ==========
  async function kembalikanBarang(pinjamId, barangId, jumlah) {
    if (!confirm('Konfirmasi pengembalian barang?')) return;
    
    showLoading();
    try {
      await db.collection('pinjam').doc(pinjamId).update({
        status: 'kembali',
        tanggalKembali: new Date().toISOString().split('T')[0]
      });
      
      await db.collection('barang').doc(barangId).update({
        jumlah: firebase.firestore.FieldValue.increment(jumlah)
      });
      
      showToast('âœ… Barang berhasil dikembalikan!', 'success');
    } catch (error) {
      showToast('âŒ Gagal: ' + error.message, 'error');
    }
    hideLoading();
  }

  // ========== FILTER BARANG ==========
  function filterBarang() {
    const search = document.getElementById('searchBarang').value.toLowerCase();
    let filtered = [...barangData];
    
    if (search) {
      filtered = filtered.filter(b => 
        b.nama?.toLowerCase().includes(search) || 
        b.kode?.toLowerCase().includes(search)
      );
    }
    
    renderTabelBarang(filtered);
  }

  // ========== FUNGSI CEK STATUS ==========
  function getStatusBadge(stok) {
    if (stok <= 0) {
      return '<span class="badge badge-danger"><i class="fas fa-times-circle"></i> Habis</span>';
    } else if (stok <= 5) {
      return '<span class="badge badge-warning"><i class="fas fa-exclamation-triangle"></i> Stok Menipis</span>';
    } else {
      return '<span class="badge badge-success"><i class="fas fa-check-circle"></i> Tersedia</span>';
    }
  }

  // ========== RENDER TABEL BARANG ==========
  function renderTabelBarang(data) {
    const tbody = document.getElementById('tabelBarang');
    
    if (data.length === 0) {
      tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 3rem;">
        <i class="fas fa-box-open" style="font-size: 3rem; color: var(--primary-light);"></i>
        <p style="margin-top: 1rem; color: var(--gray);">Belum ada data barang</p>
        <p style="color: var(--gray);">Tambah barang baru untuk memulai</p>
      </td></tr>`;
      return;
    }
    
    tbody.innerHTML = data.map(b => {
      const actionButtons = currentRole === 'admin' 
        ? `<div class="action-buttons">
            <button class="btn-edit" style="padding:0.4rem 1rem;" onclick="editBarang('${b.id}', '${b.kode}', '${b.nama}', '${b.kategori}', ${b.jumlah}, '${b.gambar}', '${b.thumbnail}', '${b.imgbb_delete_url || ''}')">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn-danger" style="padding:0.4rem 1rem;" onclick="hapusBarang('${b.id}', '${b.imgbb_delete_url || ''}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>`
        : '<span style="color:var(--gray);">-</span>';
      
      return `<tr>
        <td><span style="background:var(--primary-light); padding:0.3rem 0.7rem; border-radius:2rem; font-weight:600;">${b.kode || '-'}</span></td>
        <td><img src="${b.thumbnail || b.gambar || 'https://via.placeholder.com/50'}" class="img-preview" onclick="window.open('${b.gambar}', '_blank')"></td>
        <td><strong>${b.nama || '-'}</strong></td>
        <td>${b.kategori || '-'}</td>
        <td><span style="font-weight:700;">${b.jumlah || 0}</span></td>
        <td>${getStatusBadge(b.jumlah || 0)}</td>
        <td>${actionButtons}</td>
      </tr>`;
    }).join('');
  }

  // ========== INIT CHARTS ==========
  function initCharts() {
    const stockCtx = document.getElementById('stockChart')?.getContext('2d');
    if (stockCtx) {
      stockChart = new Chart(stockCtx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [{
            label: 'Jumlah Stok',
            data: [],
            backgroundColor: '#0284c7',
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          }
        }
      });
    }

    const pinjamCtx = document.getElementById('pinjamChart')?.getContext('2d');
    if (pinjamCtx) {
      pinjamChart = new Chart(pinjamCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Jumlah Peminjaman',
            data: [],
            borderColor: '#0284c7',
            backgroundColor: 'rgba(2, 132, 199, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false
        }
      });
    }
  }

  // ========== UPDATE CHARTS ==========
  function updateCharts() {
    // Update stock chart
    if (stockChart && barangData.length > 0) {
      const top5 = [...barangData].sort((a, b) => (b.jumlah || 0) - (a.jumlah || 0)).slice(0, 5);
      stockChart.data.labels = top5.map(b => b.nama?.substring(0, 10) + (b.nama?.length > 10 ? '...' : ''));
      stockChart.data.datasets[0].data = top5.map(b => b.jumlah || 0);
      stockChart.update();
    }

    // Update pinjam chart
    if (pinjamChart && pinjamData.length > 0) {
      const last7Days = [];
      const today = new Date();
      
      for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        last7Days.push(dateStr);
      }

      const pinjamCounts = last7Days.map(date => {
        return pinjamData.filter(p => p.tanggal === date).length;
      });

      pinjamChart.data.labels = last7Days.map(date => {
        const d = new Date(date);
        return `${d.getDate()}/${d.getMonth() + 1}`;
      });
      pinjamChart.data.datasets[0].data = pinjamCounts;
      pinjamChart.update();
    }
  }

  // ========== LOAD DATA ==========
  function loadData() {
    // LOAD BARANG
    db.collection('barang').onSnapshot(snapshot => {
      barangData = [];
      let totalStok = 0;
      let totalMenipis = 0;
      
      snapshot.forEach(doc => {
        const b = { id: doc.id, ...doc.data() };
        barangData.push(b);
        totalStok += b.jumlah || 0;
        if (b.jumlah > 0 && b.jumlah <= 5) totalMenipis++;
      });
      
      document.getElementById('totalBarang').innerText = snapshot.size;
      document.getElementById('totalTersedia').innerText = totalStok;
      document.getElementById('totalMenipis').innerText = totalMenipis;
      
      filterBarang();
      updateCharts();
      
      const select = document.getElementById('barangSelect');
      if (select) {
        select.innerHTML = '<option value="">Pilih Barang</option>';
        barangData.filter(b => b.jumlah > 0).forEach(b => {
          select.innerHTML += `<option value="${b.id}">${b.nama} (Stok: ${b.jumlah})</option>`;
        });
      }
    });

    // LOAD PEMINJAMAN
    db.collection('pinjam').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
      pinjamData = [];
      let totalAktif = 0;
      
      snapshot.forEach(doc => {
        const p = { id: doc.id, ...doc.data() };
        pinjamData.push(p);
        if (p.status === 'aktif') totalAktif++;
      });
      
      document.getElementById('totalPinjam').innerText = totalAktif;
      updateCharts();
      
      // PEMINJAMAN AKTIF
      const aktifTbody = document.getElementById('tabelPinjamAktif');
      const aktif = pinjamData.filter(p => p.status === 'aktif');
      
      if (aktif.length === 0) {
        aktifTbody.innerHTML = `<tr><td colspan="5" style="text-align: center; padding: 2rem;">
          <i class="fas fa-check-circle" style="font-size: 2rem; color: var(--success);"></i>
          <p style="margin-top: 0.5rem;">Tidak ada peminjaman aktif</p>
        </td></tr>`;
      } else {
        aktifTbody.innerHTML = aktif.map(p => `
          <tr>
            <td><i class="fas fa-user"></i> ${p.peminjam}</td>
            <td>${p.barangNama}</td>
            <td><span style="font-weight:600;">${p.jumlah}</span></td>
            <td>${p.tanggal || '-'}</td>
            <td>
              <button class="btn-success" style="padding:0.4rem 1rem;" onclick="kembalikanBarang('${p.id}','${p.barangId}',${p.jumlah})">
                <i class="fas fa-undo"></i> Kembali
              </button>
            </td>
          </tr>
        `).join('');
      }
      
      // RIWAYAT
      const riwayatTbody = document.getElementById('tabelRiwayat');
      const riwayat = pinjamData.filter(p => p.status === 'kembali').slice(0, 20);
      
      if (riwayat.length === 0) {
        riwayatTbody.innerHTML = `<tr><td colspan="5" style="text-align: center; padding: 2rem;">
          <i class="fas fa-history" style="font-size: 2rem; color: var(--gray);"></i>
          <p style="margin-top: 0.5rem;">Belum ada riwayat peminjaman</p>
        </td></tr>`;
      } else {
        riwayatTbody.innerHTML = riwayat.map(p => `
          <tr>
            <td>${p.peminjam}</td>
            <td>${p.barangNama}</td>
            <td>${p.jumlah}</td>
            <td>${p.tanggal || '-'}</td>
            <td><span class="badge badge-success"><i class="fas fa-check-circle"></i> Kembali</span></td>
          </tr>
        `).join('');
      }
      
      // RECENT PINJAM
      const recentDiv = document.getElementById('recentPinjam');
      if (recentDiv) {
        recentDiv.innerHTML = pinjamData.slice(0, 5).map(p => `
          <div style="display:flex; justify-content:space-between; align-items:center; padding:0.8rem; border-bottom:1px solid var(--border);">
            <div>
              <strong>${p.peminjam}</strong>
              <span style="color:var(--gray); margin-left:0.5rem;">- ${p.barangNama}</span>
            </div>
            <span class="badge ${p.status === 'aktif' ? 'badge-warning' : 'badge-success'}">
              ${p.status === 'aktif' ? 'Aktif' : 'Kembali'}
            </span>
          </div>
        `).join('');
        
        if (pinjamData.length === 0) {
          recentDiv.innerHTML = `<div style="text-align:center; padding:2rem; color:var(--gray);">
            <i class="fas fa-inbox" style="font-size:2rem;"></i>
            <p style="margin-top:0.5rem;">Belum ada peminjaman</p>
          </div>`;
        }
      }
    });
  }

  // ========== EXPORT EXCEL ==========
  function exportExcel() {
    try {
      const wsData = [
        ['Kode', 'Nama Barang', 'Kategori', 'Stok', 'Status']
      ];
      
      barangData.forEach(b => {
        let status = '';
        if (b.jumlah <= 0) status = 'Habis';
        else if (b.jumlah <= 5) status = 'Stok Menipis';
        else status = 'Tersedia';
        
        wsData.push([b.kode, b.nama, b.kategori || '-', b.jumlah, status]);
      });
      
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(wsData);
      XLSX.utils.book_append_sheet(wb, ws, 'Inventaris');
      XLSX.writeFile(wb, `inventaris_sd_${new Date().getTime()}.xlsx`);
      
      showToast('âœ… Export Excel berhasil!', 'success');
    } catch (error) {
      showToast('âŒ Gagal export: ' + error.message, 'error');
    }
  }

  window.onload = cekLogin;
</script>

</body>
</html>

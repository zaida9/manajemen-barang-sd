<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistem Data Barang - SD</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f4f8;
      color: #333;
    }

    .center {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .login-box {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      width: 320px;
    }

    input { width: 100%; padding: 10px; margin: 10px 0; }

    .btn { padding: 10px; border: none; border-radius: 6px; cursor: pointer; width: 100%; }
    .btn-login { background: #3b82f6; color: white; }

    .layout { display: none; min-height: 100vh; }

    .sidebar {
      width: 220px;
      background: #1e3a8a;
      color: white;
      padding: 20px;
    }

    .nav-link { display: block; margin: 10px 0; cursor: pointer; }

    .main { flex: 1; padding: 20px; }

    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px; border-bottom: 1px solid #ddd; }

    .img-preview { width: 40px; height: 40px; object-fit: cover; }
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage" class="center">
  <div class="login-box">
    <h2>Login Admin</h2>
    <input type="text" id="username" placeholder="Username" />
    <input type="password" id="password" placeholder="Password" />
    <button class="btn btn-login" onclick="login()">Masuk</button>
    <p id="loginError" style="color:red; display:none;">Login salah!</p>
  </div>
</div>

<!-- APP -->
<div id="app" class="layout">

  <div class="sidebar">
    <h3>Menu</h3>
    <div class="nav-link" onclick="showPage('dashboard')">Dashboard</div>
    <div class="nav-link" onclick="showPage('barang')">Data Barang</div>
    <div class="nav-link" onclick="logout()">Logout</div>
  </div>

  <div class="main">

    <div id="dashboard" class="page">
      <h2>Dashboard</h2>
      <p>Total Barang: <b id="totalBarang">0</b></p>
    </div>

    <div id="barang" class="page" style="display:none;">
      <h2>Data Barang</h2>
      <button onclick="openForm()">+ Tambah</button>

      <table>
        <thead>
          <tr><th>Gambar</th><th>Nama</th><th>Kode</th><th>Jumlah</th><th>Aksi</th></tr>
        </thead>
        <tbody id="tabel"></tbody>
      </table>
    </div>

  </div>
</div>

<!-- FORM -->
<div id="formBox" style="display:none; position:fixed; inset:0; background:#0008; align-items:center; justify-content:center;">
  <div style="background:white; padding:20px; border-radius:10px; width:300px;">
    <input type="hidden" id="editId">
    <input id="nama" placeholder="Nama Barang">
    <input id="kode" placeholder="Kode Barang">
    <input id="jumlah" type="number" placeholder="Jumlah">
    <input id="gambar" type="file" accept="image/*">

    <button onclick="simpan()">Simpan</button>
    <button onclick="tutupForm()">Batal</button>
  </div>
</div>

<script>
// ===== LOGIN SYSTEM =====
const ADMIN_USER = "admin";
const ADMIN_PASS = "123";

function login() {
  if (username.value === ADMIN_USER && password.value === ADMIN_PASS) {
    localStorage.setItem("login_sd", "true");
    cekLogin();
  } else {
    loginError.style.display = "block";
  }
}

function logout() {
  localStorage.removeItem("login_sd");
  location.reload();
}

function cekLogin() {
  if (localStorage.getItem("login_sd") === "true") {
    loginPage.style.display = "none";
    app.style.display = "flex";
    render();
  }
}

// ===== DATA =====
let barang = JSON.parse(localStorage.getItem("barang_sd")) || [];

function simpanStorage() {
  localStorage.setItem("barang_sd", JSON.stringify(barang));
}

// ===== PAGE =====
function showPage(id) {
  document.querySelectorAll(".page").forEach(p => p.style.display = "none");
  document.getElementById(id).style.display = "block";
}

// ===== FORM =====
function openForm(id=null) {
  formBox.style.display = "flex";

  if (id) {
    const b = barang.find(x=>x.id===id);
    editId.value = b.id;
    nama.value = b.nama;
    kode.value = b.kode;
    jumlah.value = b.jumlah;
  } else {
    editId.value = "";
    nama.value = kode.value = jumlah.value = "";
    gambar.value = "";
  }
}

function tutupForm() { formBox.style.display = "none"; }

// ===== CRUD =====
function simpan() {
  if (!nama.value || !kode.value || !jumlah.value) return alert("Lengkapi data");

  const file = gambar.files[0];

  function lanjut(img) {
    if (editId.value) {
      const i = barang.findIndex(x=>x.id==editId.value);
      barang[i] = { ...barang[i], nama:nama.value, kode:kode.value, jumlah:+jumlah.value, gambar: img || barang[i].gambar };
    } else {
      barang.push({ id:Date.now(), nama:nama.value, kode:kode.value, jumlah:+jumlah.value, gambar: img||"" });
    }

    simpanStorage();
    tutupForm();
    render();
  }

  if (file) {
    const r = new FileReader();
    r.onload = e=>lanjut(e.target.result);
    r.readAsDataURL(file);
  } else lanjut(null);
}

function hapus(id) {
  if (!confirm("Hapus?")) return;
  barang = barang.filter(x=>x.id!==id);
  simpanStorage();
  render();
}

// ===== RENDER =====
function render() {
  tabel.innerHTML = "";

  barang.forEach(b=>{
    tabel.innerHTML += `
      <tr>
        <td>${b.gambar?`<img src="${b.gambar}" class="img-preview">`:"-"}</td>
        <td>${b.nama}</td>
        <td>${b.kode}</td>
        <td>${b.jumlah}</td>
        <td>
          <button onclick="openForm(${b.id})">Edit</button>
          <button onclick="hapus(${b.id})">Hapus</button>
        </td>
      </tr>`;
  });

  totalBarang.textContent = barang.length;
}

cekLogin();
</script>

</body>
</html>

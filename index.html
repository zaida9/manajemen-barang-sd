<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5" />
  <title>Sistem Inventaris SD · Lazuardi</title>

  <!-- FIREBASE SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <!-- FONTS & ICONS -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f8fafc;
      color: #0f172a;
      line-height: 1.5;
    }

    /* LOGIN MODERN */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(145deg, #e0f2fe 0%, #bae6fd 100%);
      padding: 1.5rem;
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.5);
      border-radius: 2rem;
      padding: 2.5rem 2rem;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15);
    }

    .glass-card h2 {
      font-weight: 700;
      font-size: 1.8rem;
      color: #075985;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .glass-card h2 i {
      color: #0284c7;
    }

    .input-group {
      margin-bottom: 1.25rem;
    }

    .input-group label {
      display: block;
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #334155;
      margin-bottom: 0.4rem;
    }

    .input-field {
      width: 100%;
      padding: 0.9rem 1.2rem;
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 1.2rem;
      font-size: 1rem;
      transition: 0.2s ease;
      outline: none;
    }

    .input-field:focus {
      border-color: #0284c7;
      box-shadow: 0 0 0 4px rgba(2,132,199,0.15);
    }

    .btn-login {
      width: 100%;
      padding: 0.9rem;
      background: linear-gradient(115deg, #0369a1, #0284c7);
      border: none;
      border-radius: 1.5rem;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
      cursor: pointer;
      transition: 0.2s;
      border: 1px solid rgba(255,255,255,0.3);
    }

    .btn-login:hover {
      transform: scale(1.02);
      background: linear-gradient(115deg, #075985, #0369a1);
      box-shadow: 0 12px 20px -10px #0369a180;
    }

    #loginError {
      color: #b91c1c;
      font-weight: 600;
      margin-top: 1rem;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    /* LAYOUT UTAMA — SIDEBAR ELEGAN */
    .layout {
      display: none;
      min-height: 100vh;
      background: #f1f5f9;
    }

    .sidebar {
      position: fixed;
      width: 280px;
      height: 100vh;
      background: linear-gradient(170deg, #0c4a6e, #075985);
      backdrop-filter: blur(10px);
      padding: 2rem 1.5rem;
      color: white;
      display: flex;
      flex-direction: column;
      box-shadow: 4px 0 20px rgba(0,0,0,0.08);
    }

    .sidebar h2 {
      font-size: 1.8rem;
      font-weight: 800;
      letter-spacing: -0.01em;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 3rem;
      border-bottom: 2px solid rgba(255,255,255,0.15);
      padding-bottom: 1.5rem;
    }

    .sidebar h2 i {
      color: #fbbf24;
      text-shadow: 0 0 8px #fbbf24;
    }

    .menu {
      flex: 1;
    }

    .menu a {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      color: rgba(255,255,255,0.85);
      text-decoration: none;
      padding: 0.9rem 1.2rem;
      border-radius: 1.2rem;
      margin-bottom: 0.4rem;
      font-weight: 550;
      transition: 0.2s;
      cursor: pointer;
    }

    .menu a i {
      width: 1.5rem;
      text-align: center;
    }

    .menu a:hover, .menu a.active {
      background: rgba(255,255,255,0.12);
      color: white;
      backdrop-filter: blur(8px);
    }

    .logout-btn {
      background: rgba(239,68,68,0.15);
      border: 1px solid rgba(239,68,68,0.2);
    }

    .logout-btn:hover {
      background: rgba(239,68,68,0.3) !important;
    }

    /* CONTENT AREA */
    .content {
      margin-left: 280px;
      padding: 2rem 2.5rem;
      width: calc(100% - 280px);
    }

    /* CARD CANTIK */
    .card {
      background: white;
      border-radius: 1.75rem;
      padding: 1.8rem 2rem;
      box-shadow: 0 10px 30px -5px rgba(0,0,0,0.03), 0 5px 15px -6px rgba(0,0,0,0.02);
      border: 1px solid rgba(255,255,255,0.8);
      margin-bottom: 2rem;
      transition: 0.2s;
    }

    .card:hover {
      box-shadow: 0 20px 35px -10px rgba(2,132,199,0.08);
    }

    .card h3 {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-size: 1.4rem;
      font-weight: 700;
      color: #075985;
      margin-bottom: 1.5rem;
      border-bottom: 3px solid #e0f2fe;
      padding-bottom: 0.8rem;
    }

    /* FORM INPUT */
    input, select {
      background: #f8fafc;
      border: 2px solid #e2e8f0;
      border-radius: 1.2rem;
      padding: 0.9rem 1.2rem;
      width: 100%;
      margin-bottom: 0.8rem;
      font-size: 0.98rem;
      transition: 0.15s;
      outline: none;
    }

    input:focus, select:focus {
      border-color: #0284c7;
      background: white;
      box-shadow: 0 0 0 4px #bae6fd;
    }

    /* BUTTONS */
    .btn, .btn-warning, .btn-danger {
      border: none;
      padding: 0.8rem 1.8rem;
      border-radius: 2rem;
      font-weight: 600;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      transition: 0.2s;
      cursor: pointer;
      border: 1px solid transparent;
    }

    .btn {
      background: #0284c7;
      color: white;
    }
    .btn:hover {
      background: #0369a1;
      transform: translateY(-2px);
      box-shadow: 0 12px 16px -8px #0369a180;
    }

    .btn-warning {
      background: #f59e0b;
      color: white;
    }
    .btn-warning:hover {
      background: #d97706;
      transform: translateY(-2px);
      box-shadow: 0 12px 16px -8px #f59e0b80;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }
    .btn-danger:hover {
      background: #b91c1c;
      transform: translateY(-2px);
    }

    /* TABLE MODERN */
    .table-wrapper {
      overflow-x: auto;
      border-radius: 1.2rem;
      margin-top: 1rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 1.2rem;
    }

    th {
      background: #f0f9ff;
      color: #075985;
      font-weight: 700;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      padding: 1rem 1rem;
    }

    td {
      padding: 1rem 1rem;
      border-bottom: 1px solid #e2e8f0;
      vertical-align: middle;
    }

    tr:hover {
      background: #fafdff;
    }

    .img-preview {
      width: 52px;
      height: 52px;
      object-fit: cover;
      border-radius: 1rem;
      border: 3px solid white;
      box-shadow: 0 6px 12px rgba(0,0,0,0.06);
    }

    /* STATS CARD DASHBOARD */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
    }

    .stat-item {
      background: white;
      padding: 1.8rem 1.5rem;
      border-radius: 1.8rem;
      display: flex;
      align-items: center;
      gap: 1.2rem;
      border: 1px solid rgba(2,132,199,0.1);
      box-shadow: 0 12px 25px -10px rgba(0,0,0,0.02);
    }

    .stat-icon {
      background: linear-gradient(145deg, #e0f2fe, #bae6fd);
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 1.5rem;
      font-size: 1.8rem;
      color: #0369a1;
    }

    .stat-content h4 {
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #475569;
    }

    .stat-content span {
      font-size: 2.6rem;
      font-weight: 800;
      color: #0c4a6e;
      line-height: 1;
    }

    .hidden {
      display: none;
    }

    .file-label {
      background: #f1f5f9;
      padding: 0.7rem 1.2rem;
      border-radius: 2rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      border: 2px dashed #94a3b8;
      width: 100%;
    }

    /* cetak btn */
    .cetak-btn {
      background: #334155;
      color: white;
      margin-bottom: 1.2rem;
    }
    .cetak-btn:hover {
      background: #1e293b;
    }

    @media (max-width: 900px) {
      .sidebar { width: 100px; padding: 1rem; }
      .sidebar h2 span { display: none; }
      .menu a span { display: none; }
      .content { margin-left: 100px; width: calc(100% - 100px); }
    }
  </style>
</head>
<body>

<!-- HALAMAN LOGIN — ELEGAN -->
<div id="loginPage" class="login-container">
  <div class="glass-card">
    <h2><i class="fas fa-school"></i> Lazuardi</h2>
    <p style="color: #164863; margin-bottom: 1.8rem; font-weight: 500;">Inventaris SD · Admin panel</p>
    
    <div class="input-group">
      <label><i class="far fa-user"></i> Username</label>
      <input type="text" id="username" class="input-field" placeholder="admin" autocomplete="off">
    </div>
    <div class="input-group">
      <label><i class="fas fa-lock"></i> Password</label>
      <input type="password" id="password" class="input-field" placeholder="••••••••">
    </div>

    <button class="btn-login" onclick="login()">
      <i class="fas fa-arrow-right-to-bracket"></i> Masuk
    </button>
    <div id="loginError">
      <i class="fas fa-circle-exclamation"></i> Username / password salah
    </div>
  </div>
</div>

<!-- APLIKASI UTAMA -->
<div class="layout" id="app">
  <!-- SIDEBAR PREMIUM -->
  <div class="sidebar">
    <h2><i class="fas fa-cubes"></i> <span>SD Lazuardi</span></h2>
    <div class="menu">
      <a onclick="showPage('dashboard')" class="active" id="menu-dashboard">
        <i class="fas fa-chart-pie"></i> <span>Dashboard</span>
      </a>
      <a onclick="showPage('barang')" id="menu-barang">
        <i class="fas fa-boxes"></i> <span>Data Barang</span>
      </a>
      <a onclick="showPage('pinjam')" id="menu-pinjam">
        <i class="fas fa-hand-holding"></i> <span>Peminjaman</span>
      </a>
      <a onclick="logout()" class="logout-btn">
        <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
      </a>
    </div>
    <div style="color: rgba(255,255,255,0.5); font-size: 0.8rem; margin-top: 2rem; text-align: center">
      <i class="fas fa-shield"></i> <span>v2.0 · amanah</span>
    </div>
  </div>

  <div class="content">

    <!-- DASHBOARD MODERN -->
    <div id="dashboard">
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-icon"><i class="fas fa-box"></i></div>
          <div class="stat-content">
            <h4>Total Barang</h4>
            <span id="totalBarang">0</span>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-icon"><i class="fas fa-bookmark"></i></div>
          <div class="stat-content">
            <h4>Dipinjam</h4>
            <span id="totalPinjam">0</span>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-icon"><i class="fas fa-rotate"></i></div>
          <div class="stat-content">
            <h4>Stok Tersedia</h4>
            <span id="totalStokBersih">0</span>
          </div>
        </div>
      </div>
      <div class="card" style="margin-top: 0.5rem;">
        <h3><i class="fas fa-flag-checkered"></i> Selamat Datang, Admin!</h3>
        <p style="color: #334155;">Pantau dan kelola inventaris sekolah dengan mudah. Gunakan menu di samping untuk memulai.</p>
      </div>
    </div>

    <!-- DATA BARANG — BETTER UI -->
    <div id="barang" class="hidden">
      <div class="card">
        <h3><i class="fas fa-plus-circle"></i> Tambah Barang</h3>
        <div style="display: grid; gap: 0.8rem; grid-template-columns: repeat(auto-fit, minmax(160px,1fr));">
          <input id="nama" placeholder="Nama barang">
          <input id="jumlah" type="number" placeholder="Jumlah">
          <div style="grid-column: span 2;">
            <label for="gambar" class="file-label"><i class="fas fa-cloud-upload-alt"></i> Pilih Gambar</label>
            <input id="gambar" type="file" accept="image/*" style="display: none;" onchange="updateFileName(this)">
          </div>
        </div>
        <button class="btn" onclick="tambahBarang()" style="margin-top: 1.2rem; width: auto; padding: 0.9rem 2.5rem;"><i class="fas fa-save"></i> Simpan Barang</button>
      </div>

      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
          <h3><i class="fas fa-list-ul"></i> Daftar Barang</h3>
          <button class="btn cetak-btn" onclick="cetakPDF()"><i class="fas fa-file-pdf"></i> Cetak Laporan</button>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Kode</th><th>Nama</th><th>Jumlah</th><th>Gambar</th><th>Aksi</th></tr>
            </thead>
            <tbody id="tabelBarang"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- PEMINJAMAN — CLEAN -->
    <div id="pinjam" class="hidden">
      <div class="card">
        <h3><i class="fas fa-pen"></i> Form Peminjaman</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.2rem;">
          <input id="peminjam" placeholder="Nama peminjam">
          <select id="barangSelect" style="margin-bottom: 0;"></select>
          <input id="jumlahPinjam" type="number" placeholder="Jumlah dipinjam">
          <button class="btn-warning" onclick="pinjamBarang()" style="margin-bottom: 0;"><i class="fas fa-hand-holding-heart"></i> Pinjam</button>
        </div>
      </div>

      <div class="card">
        <h3><i class="fas fa-history"></i> Riwayat Peminjaman</h3>
        <div class="table-wrapper">
          <table>
            <thead><tr><th>Nama</th><th>Barang</th><th>Jumlah</th></tr></thead>
            <tbody id="tabelPinjam"></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAVeXYR1sI6YC9xOVhlBSbf0RFMr9Ams1g",
    authDomain: "inventaris-sd.firebaseapp.com",
    projectId: "inventaris-sd",
    storageBucket: "inventaris-sd.firebasestorage.app",
    messagingSenderId: "421661627652",
    appId: "1:421661627652:web:9ae755b3a997b8544e6c51",
    measurementId: "G-SVNDR0ZRW6"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const ADMIN_USER = "admin";
  const ADMIN_PASS = "lazuardi";

  // LOGIN
  function login() {
    const username = document.getElementById('username');
    const password = document.getElementById('password');
    const loginError = document.getElementById('loginError');
    if (username.value === ADMIN_USER && password.value === ADMIN_PASS) {
      localStorage.setItem('login', 'true');
      cekLogin();
    } else {
      loginError.style.display = 'flex';
    }
  }

  function logout() {
    localStorage.removeItem('login');
    location.reload();
  }

  function cekLogin() {
    if (localStorage.getItem('login') === 'true') {
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('app').style.display = 'flex';
      loadData();
    }
  }

  function showPage(id) {
    ['dashboard','barang','pinjam'].forEach(p => document.getElementById(p).classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    // active menu
    document.querySelectorAll('.menu a').forEach(el => el.classList.remove('active'));
    document.getElementById(`menu-${id}`).classList.add('active');
  }

  function updateFileName(input) {
    if (input.files.length > 0) {
      let label = document.querySelector('.file-label');
      if (label) label.innerHTML = `<i class="fas fa-check-circle"></i> ${input.files[0].name}`;
    }
  }

  // TAMBAH BARANG DENGAN GAMBAR
  async function tambahBarang() {
    const nama = document.getElementById('nama');
    const jumlah = document.getElementById('jumlah');
    const gambar = document.getElementById('gambar');
    if (!nama.value || !jumlah.value || !gambar.files[0]) return alert('Lengkapi semua data!');

    const reader = new FileReader();
    reader.onload = async function (e) {
      const snapshot = await db.collection('barang').get();
      const kode = 'SD-' + String(snapshot.size + 1).padStart(3, '0');
      await db.collection('barang').add({
        kode,
        nama: nama.value,
        jumlah: parseInt(jumlah.value),
        gambar: e.target.result
      });
      nama.value = '';
      jumlah.value = '';
      gambar.value = '';
      document.querySelector('.file-label').innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Pilih Gambar';
    };
    reader.readAsDataURL(gambar.files[0]);
  }

  // LOAD REAL TIME
  function loadData() {
    db.collection('barang').onSnapshot(snap => {
      const tbody = document.getElementById('tabelBarang');
      const select = document.getElementById('barangSelect');
      tbody.innerHTML = '';
      select.innerHTML = '';
      document.getElementById('totalBarang').innerText = snap.size;
      let totalStok = 0;

      snap.forEach(doc => {
        const b = doc.data();
        totalStok += b.jumlah || 0;
        tbody.innerHTML += `<tr>
          <td><span style="background:#e0f2fe; padding:0.3rem 0.7rem; border-radius:2rem; font-weight:600;">${b.kode}</span></td>
          <td><strong>${b.nama}</strong></td>
          <td><span style="background:#f1f5f9; padding:0.2rem 0.9rem; border-radius:2rem;">${b.jumlah}</span></td>
          <td>${b.gambar ? `<img src="${b.gambar}" class="img-preview">` : '-'}</td>
          <td><button class="btn-danger" onclick="hapusBarang('${doc.id}')" style="padding:0.4rem 1.2rem;"><i class="fas fa-trash"></i> Hapus</button></td>
        </tr>`;
        select.innerHTML += `<option value="${doc.id}">${b.nama} (stok ${b.jumlah})</option>`;
      });
      document.getElementById('totalStokBersih').innerText = totalStok;
    });

    db.collection('pinjam').onSnapshot(snap => {
      const tbody = document.getElementById('tabelPinjam');
      tbody.innerHTML = '';
      document.getElementById('totalPinjam').innerText = snap.size;
      snap.forEach(doc => {
        const p = doc.data();
        tbody.innerHTML += `<tr><td><i class="fas fa-user-graduate" style="color:#0284c7;"></i> ${p.nama}</td><td>${p.barang}</td><td><span style="background:#fef3c7; padding:0.2rem 0.9rem; border-radius:2rem;">${p.jumlah}</span></td></tr>`;
      });
    });
  }

  async function hapusBarang(id) {
    if (!confirm('Yakin menghapus barang ini?')) return;
    await db.collection('barang').doc(id).delete();
  }

  async function pinjamBarang() {
    const id = document.getElementById('barangSelect').value;
    const peminjam = document.getElementById('peminjam');
    const jumlahPinjam = document.getElementById('jumlahPinjam');
    const j = parseInt(jumlahPinjam.value);
    if (!id || !peminjam.value || !j) return alert('Lengkapi data peminjaman!');

    const docRef = db.collection('barang').doc(id);
    const data = (await docRef.get()).data();
    if (j > data.jumlah) return alert('Stok tidak mencukupi');

    await docRef.update({ jumlah: data.jumlah - j });
    await db.collection('pinjam').add({
      nama: peminjam.value,
      barang: data.nama,
      jumlah: j
    });
    peminjam.value = '';
    jumlahPinjam.value = '';
  }

  async function cetakPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(18);
    doc.setFont('helvetica', 'bold');
    doc.text('LAPORAN INVENTARIS SD LAZUARDI', 20, 20);
    doc.setFontSize(11);
    doc.text(`Tanggal: ${new Date().toLocaleDateString('id-ID')}`, 20, 30);
    let y = 45;
    const snapshot = await db.collection('barang').get();
    let no = 1;
    snapshot.forEach(d => {
      const b = d.data();
      doc.text(`${no}. ${b.kode} - ${b.nama}  |  Jumlah: ${b.jumlah}`, 20, y);
      y += 8;
      no++;
    });
    if (y > 270) y = 20; // handle page
    doc.save('Laporan_Inventaris_SD.pdf');
  }

  window.onload = cekLogin;
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>
